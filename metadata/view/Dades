{
    "id": "ExtBox1-ext-gen14031",
    "type": "panel",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "width": null,
        "modal": false,
        "designer|userClassName": "Dades"
    },
    "customConfigs": [],
    "designerId": "2c3d283d-b991-43c0-a226-4a278f8abbff",
    "$viewOrder": 1,
    "expanded": true,
    "cn": [
        {
            "id": "ExtBox1-ext-gen19942",
            "type": "titlebar",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "docked": "top",
                "itemId": "dadesBar",
                "title": "Dades Personals",
                "designer|userClassName": "MyTitleBar"
            },
            "customConfigs": [],
            "expanded": true
        },
        {
            "id": "ExtBox1-ext-gen14781",
            "type": "list",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "docked": null,
                "height": 370,
                "id": "prefList",
                "itemId": "PrefList",
                "ui": "round",
                "width": null,
                "layout": null,
                "itemTpl": "<p>{CodiPref}&nbsp;{Req}</p><p><small>{ValorPref}</small></p>",
                "store": "PrefStore",
                "onItemDisclosure": true,
                "designer|userClassName": "MyList"
            },
            "customConfigs": [],
            "expanded": true,
            "cn": [
                {
                    "id": "ExtBox1-ext-gen4332",
                    "type": "basiceventbinding",
                    "reference": {
                        "name": "listeners",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "fn": "onPrefListItemTap",
                        "implHandler": "Ext.Msg.prompt('Dades personals', record.get('CodiPref')+':', function(btn,text) {    \r\n    if (btn == 'ok'){      \r\n        // Validació del mail\r\n        if (record.get('IdPref') == 'EMAIL'){\r\n            console.log('Estoy en email');\r\n            if (valEmail(text)){\r\n                record.set('ValorPref', text);\r\n            }\r\n            else{\r\n                Ext.Msg.alert('Avís:', 'Adreça electrònica incorrecta. Torna a introduir-la.');\r\n            }\r\n        } \r\n        // Validació del NIF o NIE\r\n        else if (record.get('IdPref') == 'NUMDOC'){\r\n            console.log('Estoy en numdoc');\r\n            var res = valNumDoc(text);\r\n            if (res == 1 || res == 2){\r\n                record.set('ValorPref', text);\r\n            }\r\n            else{\r\n                Ext.Msg.alert('Avís:', 'Número de document incorrecte. Torna a introduir-lo.');\r\n            }\r\n        }\r\n        // Validació del mòvil\r\n        else if (record.get('IdPref') == 'TEL'){\r\n            console.log('Estoy en TEL');\r\n            if (valMovil(text)){\r\n                record.set('ValorPref', text);\r\n            }\r\n            else{\r\n                Ext.Msg.alert('Avís: ', 'Mòvil incorrecta. Torna a introduir-lo.');\r\n            }\r\n        }\r\n        else record.set('ValorPref', text);\r\n    }       \r\n});\r\n\r\nfunction valEmail(valor){\r\n    re = /^[_a-z0-9-]+(.[_a-z0-9-]+)*@[a-z0-9-]+(.[a-z0-9-]+)*(.[a-z]{2,3})$/\r\n    if(!re.exec(valor))    {\r\n        return false;\r\n    }else{\r\n        return true;\r\n    }\r\n}\r\n\r\n//Retorna: 1 = NIF ok, 2 = NIE ok, -1 = NIF error, -2 = NIE error, 0 = formato invalido\r\n//fuente: http://compartecodigo.com/javascript/validar-nif-cif-nie-segun-ley-vigente-31.html\r\nfunction valNumDoc(a) \r\n{\r\n    var temp=a.toUpperCase();\r\n    var cadenadni=\"TRWAGMYFPDXBNJZSQVHLCKE\";\r\n\r\n    if (temp!==''){\r\n        //si no tiene un formato valido devuelve error\r\n        if ((!/^[A-Z]{1}[0-9]{7}[A-Z0-9]{1}$/.test(temp) && !/^[T]{1}[A-Z0-9]{8}$/.test(temp)) && !/^[0-9]{8}[A-Z]{1}$/.test(temp))\r\n        {\r\n            return 0;\r\n        }\r\n\r\n        //comprobacion de NIFs estandar\r\n        if (/^[0-9]{8}[A-Z]{1}$/.test(temp))\r\n        {\r\n            posicion = a.substring(8,0) % 23;\r\n            letra = cadenadni.charAt(posicion);\r\n            var letradni=temp.charAt(8);\r\n            if (letra == letradni)\r\n            {\r\n                return 1;\r\n            }\r\n            else\r\n            {\r\n                return -1;\r\n            }\r\n        }\r\n\r\n        //comprobacion de NIFs especiales (se calculan como CIFs)\r\n        if (/^[KLM]{1}/.test(temp))\r\n        {\r\n            if (a[8] == String.fromCharCode(64 + n))\r\n            {\r\n                return 1;\r\n            }\r\n            else\r\n            {\r\n                return -1;\r\n            }\r\n        }\r\n\r\n\r\n        //comprobacion de NIEs\r\n        //T\r\n        if (/^[T]{1}/.test(temp))\r\n        {\r\n            if (a[8] == /^[T]{1}[A-Z0-9]{8}$/.test(temp))\r\n            {\r\n                return 2;\r\n            }\r\n            else\r\n            {\r\n                return -2;\r\n            }\r\n        }\r\n\r\n        //XYZ\r\n        if (/^[XYZ]{1}/.test(temp))\r\n        {\r\n            pos = str_replace(['X', 'Y', 'Z'], ['0','1','2'], temp).substring(0, 8) % 23;\r\n            if (a[8] == cadenadni.substring(pos, pos + 1))\r\n            {\r\n                return 2;\r\n            }\r\n            else\r\n            {\r\n                return -2;\r\n            }\r\n        }\r\n    }\r\n\r\n    return 0;\r\n}\r\n\r\n//fuente: https://raw.github.com/kvz/phpjs/master/functions/strings/str_replace.js\r\nfunction str_replace (search, replace, subject, count) {\r\n    var i = 0,\r\n    j = 0,\r\n    temp = '',\r\n    repl = '',\r\n    sl = 0,\r\n    fl = 0,\r\n    f = [].concat(search),\r\n    r = [].concat(replace),\r\n    s = subject,\r\n    ra = Object.prototype.toString.call(r) === '[object Array]',\r\n    sa = Object.prototype.toString.call(s) === '[object Array]';\r\n    s = [].concat(s);\r\n    if (count) {\r\n        this.window[count] = 0;\r\n    }\r\n\r\n    for (i = 0, sl = s.length; i < sl; i++) {\r\n        if (s[i] === '') {\r\n            continue;\r\n        }\r\n        for (j = 0, fl = f.length; j < fl; j++) {\r\n            temp = s[i] + '';\r\n            repl = ra ? (r[j] !== undefined ? r[j] : '') : r[0];\r\n            s[i] = (temp).split(f[j]).join(repl);\r\n            if (count && s[i] !== temp) {\r\n                this.window[count] += (temp.length - s[i].length) / f[j].length;\r\n            }\r\n        }\r\n    }\r\n    return sa ? s : s[0];\r\n}\r\n\r\nfunction valMovil(valor) {\r\n    re=/^\\d{9}$/\r\n    if(!re.exec(valor))    {\r\n        return false;\r\n    }else{\r\n        return true;\r\n    }    \r\n}",
                        "name": "itemtap",
                        "designer|userClassName": "onPrefListItemTap"
                    },
                    "customConfigs": [],
                    "expanded": true
                }
            ]
        },
        {
            "id": "ExtBox1-ext-gen32738",
            "type": "toolbar",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "docked": "bottom",
                "itemId": "dadesBar",
                "designer|userClassName": "MyToolbar2",
                "container|align": null
            },
            "customConfigs": [],
            "expanded": false,
            "cn": [
                {
                    "id": "ExtBox1-ext-gen6568",
                    "type": "button",
                    "reference": {
                        "name": "items",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "docked": null,
                        "id": "btnGravar",
                        "itemId": "BtnGravar",
                        "ui": "round",
                        "width": 70,
                        "text": "Gravar",
                        "designer|userClassName": "MyButton"
                    },
                    "customConfigs": [],
                    "expanded": false,
                    "cn": [
                        {
                            "id": "ExtBox1-ext-gen6980",
                            "type": "basiceventbinding",
                            "reference": {
                                "name": "listeners",
                                "type": "array"
                            },
                            "codeClass": null,
                            "userConfig": {
                                "fn": "onBtnGrabarTap",
                                "implHandler": "var store = Ext.data.StoreManager.lookup('PrefStore'),\r\nlist = Ext.getCmp('prefList'),\r\ncorrecte = 1,\r\nListStore = list.getStore();\r\n\r\nfor(var i = 0; i < ListStore.getCount(); i++) {   \r\n    if ((ListStore.getAt(i).get('Req') == '*') && (ListStore.getAt(i).get('ValorPref').length === 0)){        \r\n        Ext.Msg.alert('Error:', 'Falta introduir dades requerides.');       \r\n        correcte = 0;\r\n    }\r\n}\r\n\r\nif (correcte == 1) {\r\n    store.sync();\r\n    Ext.Msg.alert('Avís:', 'Dades gravades correctament.');\r\n    this.getParent().pop();\r\n}",
                                "name": "tap",
                                "designer|userClassName": "onBtnGrabarTap"
                            },
                            "customConfigs": [],
                            "expanded": true
                        }
                    ]
                }
            ]
        }
    ]
}