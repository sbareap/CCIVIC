{
    "id": "ExtBox1-ext-gen14031",
    "type": "panel",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "width": null,
        "modal": false,
        "designer|userClassName": "Dades"
    },
    "customConfigs": [],
    "designerId": "2c3d283d-b991-43c0-a226-4a278f8abbff",
    "$viewOrder": 1,
    "expanded": true,
    "cn": [
        {
            "id": "ExtBox1-ext-gen10624",
            "type": "titlebar",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "docked": "top",
                "itemId": "DadesTitleBar",
                "title": "Dades Personals",
                "designer|userClassName": "MyTitleBar"
            },
            "customConfigs": [],
            "expanded": true
        },
        {
            "id": "ExtBox1-ext-gen14781",
            "type": "list",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "docked": null,
                "height": 400,
                "id": "prefList",
                "itemId": "prefList",
                "ui": "round",
                "layout": null,
                "itemTpl": "<p>{CodiPref}&nbsp;{Req}</p><p><small>{ValorPref}</small></p>",
                "store": "PrefStore",
                "onItemDisclosure": true,
                "designer|userClassName": "MyList"
            },
            "customConfigs": [],
            "expanded": true,
            "cn": [
                {
                    "id": "ExtBox1-ext-gen4332",
                    "type": "basiceventbinding",
                    "reference": {
                        "name": "listeners",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "fn": "onPrefListItemTap",
                        "implHandler": "Ext.Msg.prompt('Dades personals', record.get('CodiPref')+':', function(btn,text) {    \n    if (btn == 'ok'){      \n        // Validació del mail\n        if (record.get('IdPref') == 'EMAIL'){\n            console.log('Estoy en email');\n            if (valEmail(text)){\n                record.set('ValorPref', text);\n            }\n            else{\n                Ext.Msg.alert('Avís:', 'Adreça electrònica incorrecta. Torna a introduir-la.');\n            }\n        } \n        // Validació del NIF o NIE\n        else if (record.get('IdPref') == 'NUMDOC'){\n            console.log('Estoy en numdoc');\n            var res = valNumDoc(text);\n            if (res == 1 || res == 2){\n                record.set('ValorPref', text);\n            }\n            else{\n                Ext.Msg.alert('Avís:', 'Número de document incorrecte. Torna a introduir-lo.');\n            }\n        }\n        // Validació del mòvil\n        else if (record.get('IdPref') == 'TEL'){\n            console.log('Estoy en TEL');\n            if (valMovil(text)){\n                record.set('ValorPref', text);\n            }\n            else{\n                Ext.Msg.alert('Avís:', 'Mòvil incorrecta. Torna a introduir-lo.');\n            }\n        }\n        else record.set('ValorPref', text);\n    }       \n});\n\nfunction valEmail(valor){\n    re=/^[_a-z0-9-]+(.[_a-z0-9-]+)*@[a-z0-9-]+(.[a-z0-9-]+)*(.[a-z]{2,3})$/\n    if(!re.exec(valor))    {\n        return false;\n    }else{\n        return true;\n    }\n}\n\n//Retorna: 1 = NIF ok, 2 = NIE ok, -1 = NIF error, -2 = NIE error, 0 = formato invalido\n//fuente: http://compartecodigo.com/javascript/validar-nif-cif-nie-segun-ley-vigente-31.html\nfunction valNumDoc(a) \n{\n    var temp=a.toUpperCase();\n    var cadenadni=\"TRWAGMYFPDXBNJZSQVHLCKE\";\n\n    if (temp!==''){\n        //si no tiene un formato valido devuelve error\n        if ((!/^[A-Z]{1}[0-9]{7}[A-Z0-9]{1}$/.test(temp) && !/^[T]{1}[A-Z0-9]{8}$/.test(temp)) && !/^[0-9]{8}[A-Z]{1}$/.test(temp))\n        {\n            return 0;\n        }\n\n        //comprobacion de NIFs estandar\n        if (/^[0-9]{8}[A-Z]{1}$/.test(temp))\n        {\n            posicion = a.substring(8,0) % 23;\n            letra = cadenadni.charAt(posicion);\n            var letradni=temp.charAt(8);\n            if (letra == letradni)\n            {\n                return 1;\n            }\n            else\n            {\n                return -1;\n            }\n        }\n\n        //comprobacion de NIFs especiales (se calculan como CIFs)\n        if (/^[KLM]{1}/.test(temp))\n        {\n            if (a[8] == String.fromCharCode(64 + n))\n            {\n                return 1;\n            }\n            else\n            {\n                return -1;\n            }\n        }\n\n\n        //comprobacion de NIEs\n        //T\n        if (/^[T]{1}/.test(temp))\n        {\n            if (a[8] == /^[T]{1}[A-Z0-9]{8}$/.test(temp))\n            {\n                return 2;\n            }\n            else\n            {\n                return -2;\n            }\n        }\n\n        //XYZ\n        if (/^[XYZ]{1}/.test(temp))\n        {\n            pos = str_replace(['X', 'Y', 'Z'], ['0','1','2'], temp).substring(0, 8) % 23;\n            if (a[8] == cadenadni.substring(pos, pos + 1))\n            {\n                return 2;\n            }\n            else\n            {\n                return -2;\n            }\n        }\n    }\n\n    return 0;\n}\n\n//fuente: https://raw.github.com/kvz/phpjs/master/functions/strings/str_replace.js\nfunction str_replace (search, replace, subject, count) {\n    var i = 0,\n        j = 0,\n        temp = '',\n        repl = '',\n        sl = 0,\n        fl = 0,\n        f = [].concat(search),\n        r = [].concat(replace),\n        s = subject,\n        ra = Object.prototype.toString.call(r) === '[object Array]',\n        sa = Object.prototype.toString.call(s) === '[object Array]';\n    s = [].concat(s);\n    if (count) {\n        this.window[count] = 0;\n    }\n\n    for (i = 0, sl = s.length; i < sl; i++) {\n        if (s[i] === '') {\n            continue;\n        }\n        for (j = 0, fl = f.length; j < fl; j++) {\n            temp = s[i] + '';\n            repl = ra ? (r[j] !== undefined ? r[j] : '') : r[0];\n            s[i] = (temp).split(f[j]).join(repl);\n            if (count && s[i] !== temp) {\n                this.window[count] += (temp.length - s[i].length) / f[j].length;\n            }\n        }\n    }\n    return sa ? s : s[0];\n}\n\nfunction valMovil(valor) {\n    re=/^\\d{9}$/\n    if(!re.exec(valor))    {\n        return false;\n    }else{\n        return true;\n    }    \n}",
                        "name": "itemtap",
                        "designer|userClassName": "onPrefListItemTap"
                    },
                    "customConfigs": [],
                    "expanded": true
                }
            ]
        },
        {
            "id": "ExtBox1-ext-gen6568",
            "type": "button",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "docked": "bottom",
                "id": "btnGrabar",
                "itemId": "BtnGrabar",
                "ui": "round",
                "width": null,
                "text": "Grabar",
                "designer|userClassName": "MyButton"
            },
            "customConfigs": [],
            "expanded": true,
            "cn": [
                {
                    "id": "ExtBox1-ext-gen6980",
                    "type": "basiceventbinding",
                    "reference": {
                        "name": "listeners",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "fn": "onBtnGrabarTap",
                        "implHandler": "var store = Ext.data.StoreManager.lookup('PrefStore'),\n    list = Ext.getCmp('prefList'),\n    correcte = 1,\n    ListStore = list.getStore();\n\nfor(var i = 0; i < ListStore.getCount(); i++) {   \n    if ((ListStore.getAt(i).get('Req') == '*') && (ListStore.getAt(i).get('ValorPref').length === 0)){\n        console.log(ListStore.getAt(i).get('Req'));\n        console.log(ListStore.getAt(i).get('ValorPref').length);\n        Ext.Msg.alert('Error:', 'Falta introduir dades requerides.');       \n        correcte = 0;\n    }\n}\n\nif (correcte == 1) {\n    store.sync();\n    Ext.Msg.alert('Avís:', 'Dades gravades correctament.');\n    this.getParent().pop();\n}",
                        "name": "tap",
                        "designer|userClassName": "onBtnGrabarTap"
                    },
                    "customConfigs": [],
                    "expanded": true
                }
            ]
        }
    ]
}